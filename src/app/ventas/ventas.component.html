<div class="p-6">
  <h1 class="text-3xl font-bold text-gray-800 mb-6 flex items-center">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 mr-2">
      <path d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.75 3.75 0 0 0 3.694 2.46l2.558-.054V18a2.25 2.25 0 0 0 2.25 2.25h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.386c.17 0 .318-.114.362-.278l2.558-9.592a3.75 3.75 0 0 0 3.694-2.46l2.558-.054V18a2.25 2.25 0 0 0 2.25 2.25h2.25a2.25 2.25 0 0 0 2.25-2.25V6.75a.75.75 0 0 0-.75-.75H14.25a.75.75 0 0 0-.75.75v1.866c0 .285.24.516.525.516H21.43l-2.558 9.592a2.25 2.25 0 0 1-2.204 1.46L14.25 18a.75.75 0 0 0-.75-.75H11.25a.75.75 0 0 0-.75.75v1.386c-.17 0-.318.114-.362.278l-2.558 9.592a2.25 2.25 0 0 1-2.204 1.46L3.75 18H2.25a.75.75 0 0 0-.75.75v1.386c-.17 0-.318.114-.362.278L1.5 22.5h-.75a.75.75 0 0 0-.75-.75V2.25Z" />
      <path d="M12.75 15a.75.75 0 0 0-.75-.75H8.25a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 .75.75h3.75a.75.75 0 0 0 .75-.75v-1.5Z" />
    </svg>
    Venta
  </h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <div>
      <label for="cliente" class="block text-gray-700 font-semibold mb-2">Cliente *</label>
      <select id="cliente" [(ngModel)]="clienteSeleccionadoId" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option [ngValue]="null" disabled>Selecciona un cliente</option>
        <option *ngFor="let usuario of usuarios" [ngValue]="usuario.idUsuario">
          {{ usuario.nombre }} {{ usuario.apellidoPaterno }} {{ usuario.apellidoMaterno }}
        </option>
      </select>
    </div>
    <div>
      <label for="fecha" class="block text-gray-700 font-semibold mb-2">Fecha *</label>
      <input type="datetime-local" id="fecha" [(ngModel)]="fechaVenta" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>
  </div>

  <h2 class="text-xl font-semibold text-gray-700 mb-4">Detalle de Productos:</h2>

  <div *ngFor="let detalle of detallesVenta; let i = index" class="mb-4 p-4 border border-gray-200 rounded-md bg-gray-50 grid grid-cols-1 md:grid-cols-5 gap-4 items-end relative">
    <div class="md:col-span-2">
      <label for="producto-{{i}}" class="block text-gray-700 text-sm font-medium mb-1">Producto *</label>
      <select id="producto-{{i}}" [(ngModel)]="detalle.productoSeleccionado" (change)="onProductoChange(i)"
              [ngModelOptions]="{standalone: true}" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option [ngValue]="null" disabled>Selecciona un producto</option>
        <option *ngFor="let producto of productos" [ngValue]="producto">
          {{ producto.nombre }} ({{ producto.tipo | titlecase }}) - Disp: {{ producto.cantidadDisponible }}
        </option>
      </select>
    </div>
    <div>
      <label for="cantidad-{{i}}" class="block text-gray-700 text-sm font-medium mb-1">Cantidad *</label>
      <input type="number" id="cantidad-{{i}}" [(ngModel)]="detalle.cantidad" (input)="onCantidadChange(i)" min="1"
             [max]="detalle.stockActual"
             [ngModelOptions]="{standalone: true}" class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
      <p *ngIf="detalle.productoSeleccionado && detalle.cantidad && detalle.cantidad > detalle.stockActual" class="text-red-500 text-xs mt-1">
        Stock insuficiente. Max: {{ detalle.stockActual }}
      </p>
    </div>
    <div class="md:col-span-1">
      <label for="nota-{{i}}" class="block text-gray-700 text-sm font-medium mb-1">Nota</label>
      <input type="text" id="nota-{{i}}" [(ngModel)]="detalle.nota" [ngModelOptions]="{standalone: true}"
             class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
    </div>

    <div class="flex space-x-2 md:col-span-1 md:justify-end">
      <button *ngIf="i === detallesVenta.length - 1" (click)="addDetalleVenta()"
              class="bg-green-500 hover:bg-green-600 text-white font-bold p-2 rounded-full w-8 h-8 flex items-center justify-center text-xl leading-none">
        +
      </button>
      <button *ngIf="detallesVenta.length > 1" (click)="removeDetalleVenta(i)"
              class="bg-red-500 hover:bg-red-600 text-white font-bold p-2 rounded-full w-8 h-8 flex items-center justify-center text-xl leading-none">
        -
      </button>
    </div>
  </div>

  <div class="text-right mt-8">
    <button (click)="registrarVenta()"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg flex items-center justify-center ml-auto">
      Vender
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 ml-2">
        <path d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.75 3.75 0 0 0 3.694 2.46l2.558-.054V18a2.25 2.25 0 0 0 2.25 2.25h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.386c.17 0 .318-.114.362-.278l2.558-9.592a3.75 3.75 0 0 0 3.694-2.46l2.558-.054V18a2.25 2.25 0 0 0 2.25 2.25h2.25a2.25 2.25 0 0 0 2.25-2.25V6.75a.75.75 0 0 0-.75-.75H14.25a.75.75 0 0 0-.75.75v1.866c0 .285.24.516.525.516H21.43l-2.558 9.592a2.25 2.25 0 0 1-2.204 1.46L14.25 18a.75.75 0 0 0-.75-.75H11.25a.75.75 0 0 0-.75.75v1.386c-.17 0-.318.114-.362.278l-2.558 9.592a2.25 2.25 0 0 1-2.204 1.46L3.75 18H2.25a.75.75 0 0 0-.75.75v1.386c-.17 0-.318.114-.362.278L1.5 22.5h-.75a.75.75 0 0 0-.75-.75V2.25Z" />
        <path d="M12.75 15a.75.75 0 0 0-.75-.75H8.25a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 .75.75h3.75a.75.75 0 0 0 .75-.75v-1.5Z" />
      </svg>
    </button>
  </div>
</div>
