<div class="p-6 space-y-8 bg-white rounded-lg shadow-lg">
  <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-blue-600">
      <path fill-rule="evenodd" d="M7.5 6v.75H5.513c-.96 0-1.764.724-1.865 1.679l-1.263 12A1.875 1.875 0 0 0 4.25 22.5h15.5a1.875 1.875 0 0 0 1.865-2.071l-1.263-12a1.875 1.875 0 0 0-1.865-1.679H16.5V6a4.5 4.5 0 1 0-9 0ZM12 3a3 3 0 0 0-3 3v.75h6V6a3 3 0 0 0-3-3Zm-3 8.25a3 3 0 1 0 6 0v-.75a.75.75 0 0 1 1.5 0v.75a4.5 4.5 0 1 1-9 0v-.75a.75.75 0 0 1 1.5 0v.75Z" clip-rule="evenodd" />
    </svg>
    Venta
  </h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Cliente *</label>
      <select [(ngModel)]="clienteSeleccionadoId"
              class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
        <option [ngValue]="null" disabled>Selecciona un cliente</option>
        <option *ngFor="let usuario of usuarios" [ngValue]="usuario.idUsuario">
          {{ usuario.nombre }} {{ usuario.apellidoPaterno }} {{ usuario.apellidoMaterno }}
        </option>
      </select>
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Fecha *</label>
      <input type="datetime-local" [(ngModel)]="fechaVenta"
             class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
    </div>
  </div>

  <div>
    <h2 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">Detalle de Productos:</h2>

    <div *ngFor="let detalle of detallesVenta; let i = index"
         class="mb-4 p-4 bg-white rounded-lg shadow-md border border-gray-200 space-y-4 md:space-y-0 md:grid md:grid-cols-5 gap-4 items-end relative">

      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700 mb-1">Producto *</label>
        <select [(ngModel)]="detalle.productoSeleccionado" (change)="onProductoChange(i)"
                [ngModelOptions]="{standalone: true}"
                class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option [ngValue]="null" disabled>Selecciona un producto</option>
          <option *ngFor="let producto of productos" [ngValue]="producto">
            {{ producto.nombre }} ({{ producto.tipo | titlecase }}) - Disp: {{ producto.cantidadDisponible }}
          </option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Cantidad *</label>
        <input type="number" [(ngModel)]="detalle.cantidad" (input)="onCantidadChange(i)" min="1"
               [max]="detalle.stockActual"
               [ngModelOptions]="{standalone: true}"
               class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <p *ngIf="detalle.productoSeleccionado && detalle.cantidad && detalle.cantidad > detalle.stockActual"
           class="text-red-500 text-xs mt-1">
          Stock insuficiente. Max: {{ detalle.stockActual }}
        </p>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Nota</label>
        <input type="text" [(ngModel)]="detalle.nota"
               [ngModelOptions]="{standalone: true}"
               class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
      </div>

      <div class="flex items-center justify-end space-x-2">
        <button *ngIf="i === detallesVenta.length - 1" (click)="addDetalleVenta()"
                class="bg-green-500 hover:bg-green-600 text-white font-bold p-2 w-10 h-10 flex items-center justify-center rounded-md transition-colors duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
            <path fill-rule="evenodd" d="M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
          </svg>
        </button>
        <button *ngIf="detallesVenta.length > 1" (click)="removeDetalleVenta(i)"
                class="bg-red-500 hover:bg-red-600 text-white font-bold p-2 w-10 h-10 flex items-center justify-center rounded-md transition-colors duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
            <path fill-rule="evenodd" d="M3.75 12a.75.75 0 0 1 .75-.75h15a.75.75 0 0 1 0 1.5H4.5a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="text-right mt-8">
    <button (click)="registrarVenta()"
            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg flex items-center justify-center ml-auto transition-colors duration-200">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 mr-2">
        <path d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 0 0-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 0 0 0-1.5H5.378A2.25 2.25 0 0 1 7.5 15h11.218a.75.75 0 0 0 .674-.421 60.358 60.358 0 0 0 2.96-7.228.75.75 0 0 0-.525-.965A60.864 60.864 0 0 0 5.68 4.509l-.232-.867A1.875 1.875 0 0 0 3.636 2.25H2.25ZM3.75 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" />
      </svg>
      Vender
    </button>
  </div>
</div>
